---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: zoo
spec:
  template:
    spec:
      containers:
      - name: zookeeper
        image: solsson/zookeeper-native@sha256:e8e43153588fc106d1e90bc62b69ebe9983d73862efb83a6e024a814681b9d8a
        # This image will echo out the command generated by the endryoint, try: docker run --rm <image>
        command:
        - /opt/java/openjdk/bin/java
        - -Dzookeeper.root.logger=INFO,CONSOLE
        - -XX:+HeapDumpOnOutOfMemoryError
        - -XX:OnOutOfMemoryError=kill
        - -cp
        - ./lib/zookeeper-prometheus-metrics-3.6.1.jar:./lib/zookeeper-jute-3.6.1.jar:./lib/zookeeper-3.6.1.jar:./lib/snappy-java-1.1.7.jar:./lib/slf4j-log4j12-1.7.25.jar:./lib/slf4j-api-1.7.25.jar:./lib/simpleclient_servlet-0.6.0.jar:./lib/simpleclient_hotspot-0.6.0.jar:./lib/simpleclient_common-0.6.0.jar:./lib/simpleclient-0.6.0.jar:./lib/netty-transport-native-unix-common-4.1.48.Final.jar:./lib/netty-transport-native-epoll-4.1.48.Final.jar:./lib/netty-transport-4.1.48.Final.jar:./lib/netty-resolver-4.1.48.Final.jar:./lib/netty-handler-4.1.48.Final.jar:./lib/netty-common-4.1.48.Final.jar:./lib/netty-codec-4.1.48.Final.jar:./lib/netty-buffer-4.1.48.Final.jar:./lib/metrics-core-3.2.5.jar:./lib/log4j-1.2.17.jar:./lib/json-simple-1.1.1.jar:./lib/jline-2.11.jar:./lib/jetty-util-9.4.24.v20191120.jar:./lib/jetty-servlet-9.4.24.v20191120.jar:./lib/jetty-server-9.4.24.v20191120.jar:./lib/jetty-security-9.4.24.v20191120.jar:./lib/jetty-io-9.4.24.v20191120.jar:./lib/jetty-http-9.4.24.v20191120.jar:./lib/javax.servlet-api-3.1.0.jar:./lib/jackson-databind-2.10.3.jar:./lib/jackson-core-2.10.3.jar:./lib/jackson-annotations-2.10.3.jar:./lib/commons-lang-2.6.jar:./lib/commons-cli-1.2.jar:./lib/audience-annotations-0.5.0.jar
        #- -Xmx1000m
        #- -Dcom.sun.management.jmxremote
        #- -Dcom.sun.management.jmxremote.local.only=false
        - -Dlog4j.configuration=file:/etc/kafka/log4j.properties
        - -Dzookeeper.datadir.autocreate=true
        - -Dzookeeper.db.autocreate=false
        - org.apache.zookeeper.server.quorum.QuorumPeerMain
        args:
        - /etc/kafka/zookeeper.properties.scale-$(REPLICAS).$(POD_NAME)
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: pzoo
spec:
  template:
    spec:
      containers:
      - name: zookeeper
        image: solsson/zookeeper-native@sha256:2f9b0abc6e2cc65d9eae61d451e886e6645bcf2a47e1ef97872d8fdde6f64373
        # This image has graalvm native-agent, so we can generate config json for native-image compile
        #image: solsson/zookeeper-native@sha256:e8e43153588fc106d1e90bc62b69ebe9983d73862efb83a6e024a814681b9d8a
        # The above image will echo out the command generated by the endryoint, try: docker run --rm <image>
        command:
        - /opt/java/openjdk/bin/java
        - -Dzookeeper.root.logger=INFO,CONSOLE
        - -XX:+HeapDumpOnOutOfMemoryError
        - -XX:OnOutOfMemoryError=kill
        - -cp
        - ./lib/zookeeper-prometheus-metrics-3.6.1.jar:./lib/zookeeper-jute-3.6.1.jar:./lib/zookeeper-3.6.1.jar:./lib/snappy-java-1.1.7.jar:./lib/slf4j-log4j12-1.7.25.jar:./lib/slf4j-api-1.7.25.jar:./lib/simpleclient_servlet-0.6.0.jar:./lib/simpleclient_hotspot-0.6.0.jar:./lib/simpleclient_common-0.6.0.jar:./lib/simpleclient-0.6.0.jar:./lib/netty-transport-native-unix-common-4.1.48.Final.jar:./lib/netty-transport-native-epoll-4.1.48.Final.jar:./lib/netty-transport-4.1.48.Final.jar:./lib/netty-resolver-4.1.48.Final.jar:./lib/netty-handler-4.1.48.Final.jar:./lib/netty-common-4.1.48.Final.jar:./lib/netty-codec-4.1.48.Final.jar:./lib/netty-buffer-4.1.48.Final.jar:./lib/metrics-core-3.2.5.jar:./lib/log4j-1.2.17.jar:./lib/json-simple-1.1.1.jar:./lib/jline-2.11.jar:./lib/jetty-util-9.4.24.v20191120.jar:./lib/jetty-servlet-9.4.24.v20191120.jar:./lib/jetty-server-9.4.24.v20191120.jar:./lib/jetty-security-9.4.24.v20191120.jar:./lib/jetty-io-9.4.24.v20191120.jar:./lib/jetty-http-9.4.24.v20191120.jar:./lib/javax.servlet-api-3.1.0.jar:./lib/jackson-databind-2.10.3.jar:./lib/jackson-core-2.10.3.jar:./lib/jackson-annotations-2.10.3.jar:./lib/commons-lang-2.6.jar:./lib/commons-cli-1.2.jar:./lib/audience-annotations-0.5.0.jar
        #- -Xmx1000m
        #- -Dcom.sun.management.jmxremote
        #- -Dcom.sun.management.jmxremote.local.only=false
        - -Dlog4j.configuration=file:/etc/kafka/log4j.properties
        - -Dzookeeper.datadir.autocreate=false
        - -Dzookeeper.db.autocreate=false
        - org.apache.zookeeper.server.quorum.QuorumPeerMain
        args:
        - /etc/kafka/zookeeper.properties.scale-$(REPLICAS).$(POD_NAME)
